syntax = "proto3";

package tournament;

message Player {
  string uuid = 1;
  bool ready = 2;
  bool connected = 3;
  bool eliminated = 4;
}

message MatchNode {
  string player1Id = 1;
  string player2Id = 2;
  repeated int32 score = 3;
  string gameId    = 4;
  MatchNode left   = 5;
  MatchNode right  = 6;
  string winnerId  = 7;
  string forfeitId = 8;
}

message TournamentUpdateMessage {
  MatchNode tournamentRoot = 1;
  repeated Player players  = 2;
}

message TournamentClientReadyMessage {}

message TournamentReadyCheckMessage {
  int64 deadlineMs = 1;
}

message TournamentFinishedMessage {}

message TournamentQuitMessage {}

message TournamentErrorMessage {
  string message = 1;
}

message TournamentCreateRequest {
  repeated string players = 1;
}
message TournamentCreateResponse {
  string tournamentId = 1;
}

message TournamentClientMessage {
  oneof payload {
    TournamentQuitMessage quit = 1;
    TournamentClientReadyMessage ready = 2;
  }
}

message TournamentStartGameMessage {
  string gameId = 1;
}

message TournamentServerMessage {
  oneof payload {
    TournamentUpdateMessage update   = 1;
    TournamentErrorMessage error     = 2;
    TournamentReadyCheckMessage readyCheck = 3;
    TournamentStartGameMessage startGame   = 4;
  }
}
