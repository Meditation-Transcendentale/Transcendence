name: Game Services CI

on:
  push:
    branches: [main, dev]
  pull_request:

jobs:
  test-services:
    runs-on: ubuntu-latest

    # strategy:
    #   matrix:
    #     service:
    #       - services/game/game-manager
    #       - services/game/user-interface
    #       - services/game/pong-physics
    #       - services/game/pongBR-physics
    #       - services/game/pongIO-physics
    #       - services/game/ai

    # defaults:
    #   run:
    #     working-directory: ${{ matrix.service }}

    steps:
      - name: ğŸ“¥ Checkout repo
        uses: actions/checkout@v3

      - name: ğŸ”§ Setup Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ğŸ³ Build up
        run: docker compose -f docker-compose.yml -f ./services/stats/docker-compose-stats.yml up --build

      - name: ğŸ³ List running containers
        run: docker ps -a

      - name: ğŸ³ Check container status
        run: |
          docker compose ps
          if docker compose ps | grep -v "Up"; then
            echo "Some containers are not running!"
            exit 1
          fi

      - name: â³ Wait for services
        run: sleep 10

      - name: Health check API
        run: |
          curl --fail https://localhost:3000/health || exit 1


